<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFT Workshop - Build Your Character</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a2e 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 40px 0;
            position: relative;
        }
        
        h1 {
            font-size: 3em;
            background: linear-gradient(90deg, #ff006e, #8338ec, #3a86ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            animation: glow 3s ease-in-out infinite;
        }
        
        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(131, 56, 236, 0.5)); }
            50% { filter: drop-shadow(0 0 30px rgba(255, 0, 110, 0.8)); }
        }
        
        .tagline {
            font-size: 1.2em;
            color: #8338ec;
            margin-bottom: 30px;
        }
        
        .builder-container {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 30px;
            margin-top: 40px;
        }
        
        .trait-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 600px;
            overflow-y: auto;
        }
        
        .trait-panel h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #ff006e;
        }
        
        .trait-category {
            margin-bottom: 25px;
        }
        
        .trait-category h3 {
            font-size: 1.1em;
            margin-bottom: 10px;
            color: #3a86ff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .trait-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .trait-option {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .trait-option:hover {
            transform: scale(1.05);
            border-color: #8338ec;
            box-shadow: 0 0 20px rgba(131, 56, 236, 0.5);
        }
        
        .trait-option.selected {
            border-color: #ff006e;
            box-shadow: 0 0 30px rgba(255, 0, 110, 0.5);
            background: rgba(255, 0, 110, 0.1);
        }
        
        .trait-option.locked {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .trait-option.locked:hover {
            transform: none;
            border-color: transparent;
            box-shadow: none;
        }
        
        .trait-icon {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
        }
        
        .preview-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .character-preview {
            width: 400px;
            height: 400px;
            position: relative;
            background: radial-gradient(circle, rgba(131, 56, 236, 0.1) 0%, transparent 70%);
            border-radius: 20px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: grab;
            overflow: hidden;
        }
        
        .character-preview:active {
            cursor: grabbing;
        }
        
        .character-canvas {
            width: 320px;
            height: 320px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.3s ease;
        }
        
        .character-layer {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8em;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.3));
        }
        
        #specialLayer {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .action-buttons {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #ff006e, #8338ec);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(131, 56, 236, 0.5);
        }
        
        .btn-secondary {
            background: transparent;
            color: #3a86ff;
            border: 2px solid #3a86ff;
        }
        
        .btn-secondary:hover {
            background: #3a86ff;
            color: white;
        }
        
        .stats-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stats-panel h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #3a86ff;
        }
        
        .stat-item {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .stat-item.unlocked {
            background: rgba(255, 0, 110, 0.1);
            border: 1px solid rgba(255, 0, 110, 0.3);
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #8338ec;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .rarity-indicator {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8em;
            margin-left: 10px;
        }
        
        .rarity-common { background: #6c757d; }
        .rarity-uncommon { background: #28a745; }
        .rarity-rare { background: #007bff; }
        .rarity-epic { background: #6f42c1; }
        .rarity-legendary { background: #ffc107; color: #000; }
        
        .name-input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }
        
        .name-input:focus {
            outline: none;
            border-color: #8338ec;
            box-shadow: 0 0 20px rgba(131, 56, 236, 0.3);
        }
        
        .share-section {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            text-align: center;
        }
        
        .share-code {
            font-family: monospace;
            font-size: 1.2em;
            color: #ff006e;
            margin: 10px 0;
            user-select: all;
        }
        
        .workshop-timer {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 0, 110, 0.1);
            border: 2px solid #ff006e;
            border-radius: 10px;
            padding: 15px 25px;
            font-size: 1.2em;
            font-weight: bold;
            z-index: 1000;
        }
        
        .loader {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 30px 50px;
            border-radius: 20px;
            border: 2px solid #8338ec;
            z-index: 2000;
            display: none;
        }
        
        .loader.active {
            display: block;
        }
        
        .loader-text {
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        
        .loader-bar {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .loader-progress {
            height: 100%;
            background: linear-gradient(90deg, #ff006e, #8338ec);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 15px 30px;
            border-radius: 10px;
            border: 2px solid #28a745;
            z-index: 3000;
            display: none;
            animation: slideDown 0.3s ease;
        }
        
        .notification.show {
            display: block;
        }
        
        @keyframes slideDown {
            from { transform: translateX(-50%) translateY(-100px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
        
        @keyframes sparkle {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            100% { transform: scale(1.5) rotate(180deg); opacity: 0; }
        }
        
        .sparkle {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #ff006e 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            animation: sparkle 0.6s ease-out;
        }
        
        @media (max-width: 1200px) {
            .builder-container {
                grid-template-columns: 1fr;
            }
            
            .trait-panel, .stats-panel {
                max-height: none;
            }
            
            .workshop-timer {
                top: auto;
                bottom: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>NFT Workshop</h1>
            <p class="tagline">Build-A-Bear meets Web3 ‚ú®</p>
        </header>
        
        <div class="workshop-timer" id="workshopTimer">
            Workshop Mode: <span id="timerDisplay">05:00</span>
        </div>
        
        <div class="loader" id="loader">
            <div class="loader-text" id="loaderText">Connecting to blockchain...</div>
            <div class="loader-bar">
                <div class="loader-progress" id="loaderProgress"></div>
            </div>
        </div>
        
        <div class="notification" id="notification">
            <span id="notificationText"></span>
        </div>
        
        <div class="builder-container">
            <div class="trait-panel">
                <h2>üé® Trait Selection</h2>
                
                <div class="trait-category">
                    <h3>üë§ Base</h3>
                    <div class="trait-options" id="baseOptions">
                        <div class="trait-option selected" data-trait="base" data-value="human">
                            <div class="trait-icon">üßë</div>
                        </div>
                        <div class="trait-option" data-trait="base" data-value="robot">
                            <div class="trait-icon">ü§ñ</div>
                        </div>
                        <div class="trait-option" data-trait="base" data-value="alien">
                            <div class="trait-icon">üëΩ</div>
                        </div>
                    </div>
                </div>
                
                <div class="trait-category">
                    <h3>üëï Outfit</h3>
                    <div class="trait-options" id="outfitOptions">
                        <div class="trait-option" data-trait="outfit" data-value="ninja">
                            <div class="trait-icon">ü•∑</div>
                        </div>
                        <div class="trait-option" data-trait="outfit" data-value="suit">
                            <div class="trait-icon">ü§µ</div>
                        </div>
                        <div class="trait-option" data-trait="outfit" data-value="hoodie">
                            <div class="trait-icon">üß•</div>
                        </div>
                        <div class="trait-option" data-trait="outfit" data-value="armor">
                            <div class="trait-icon">üõ°Ô∏è</div>
                        </div>
                        <div class="trait-option locked" data-trait="outfit" data-value="golden">
                            <div class="trait-icon">‚ú®</div>
                        </div>
                    </div>
                </div>
                
                <div class="trait-category">
                    <h3>üëÅÔ∏è Eyes</h3>
                    <div class="trait-options" id="eyesOptions">
                        <div class="trait-option" data-trait="eyes" data-value="normal">
                            <div class="trait-icon">üëÄ</div>
                        </div>
                        <div class="trait-option" data-trait="eyes" data-value="laser">
                            <div class="trait-icon">üî¥</div>
                        </div>
                        <div class="trait-option" data-trait="eyes" data-value="cool">
                            <div class="trait-icon">üòé</div>
                        </div>
                        <div class="trait-option" data-trait="eyes" data-value="heart">
                            <div class="trait-icon">üòç</div>
                        </div>
                        <div class="trait-option" data-trait="eyes" data-value="star">
                            <div class="trait-icon">ü§©</div>
                        </div>
                        <div class="trait-option locked" data-trait="eyes" data-value="diamond">
                            <div class="trait-icon">üíé</div>
                        </div>
                    </div>
                </div>
                
                <div class="trait-category">
                    <h3>üé© Headgear</h3>
                    <div class="trait-options" id="headgearOptions">
                        <div class="trait-option" data-trait="headgear" data-value="none">
                            <div class="trait-icon">‚ùå</div>
                        </div>
                        <div class="trait-option" data-trait="headgear" data-value="cap">
                            <div class="trait-icon">üß¢</div>
                        </div>
                        <div class="trait-option" data-trait="headgear" data-value="crown">
                            <div class="trait-icon">üëë</div>
                        </div>
                        <div class="trait-option" data-trait="headgear" data-value="helmet">
                            <div class="trait-icon">‚õëÔ∏è</div>
                        </div>
                        <div class="trait-option" data-trait="headgear" data-value="horns">
                            <div class="trait-icon">üòà</div>
                        </div>
                        <div class="trait-option" data-trait="headgear" data-value="halo">
                            <div class="trait-icon">üòá</div>
                        </div>
                    </div>
                </div>
                
                <div class="trait-category">
                    <h3>‚ú® Special</h3>
                    <div class="trait-options" id="specialOptions">
                        <div class="trait-option" data-trait="special" data-value="none">
                            <div class="trait-icon">‚ùå</div>
                        </div>
                        <div class="trait-option" data-trait="special" data-value="fire">
                            <div class="trait-icon">üî•</div>
                        </div>
                        <div class="trait-option" data-trait="special" data-value="ice">
                            <div class="trait-icon">‚ùÑÔ∏è</div>
                        </div>
                        <div class="trait-option" data-trait="special" data-value="lightning">
                            <div class="trait-icon">‚ö°</div>
                        </div>
                        <div class="trait-option locked" data-trait="special" data-value="rainbow">
                            <div class="trait-icon">üåà</div>
                        </div>
                        <div class="trait-option locked" data-trait="special" data-value="cosmic">
                            <div class="trait-icon">üåå</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="preview-area">
                <div class="character-preview" id="characterPreview">
                    <div class="character-canvas" id="characterCanvas">
                        <div class="character-layer" id="baseLayer">üßë</div>
                        <div class="character-layer" id="outfitLayer"></div>
                        <div class="character-layer" id="eyesLayer"></div>
                        <div class="character-layer" id="headgearLayer"></div>
                        <div class="character-layer" id="specialLayer"></div>
                    </div>
                </div>
                
                <input type="text" class="name-input" id="characterName" placeholder="Name your creation..." maxlength="30">
                
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="randomizeCharacter()">üé≤ Randomize</button>
                    <button class="btn btn-primary" onclick="mintCharacter()">üöÄ Mint NFT</button>
                </div>
                
                <div class="share-section">
                    <p>Share your build code:</p>
                    <div class="share-code" id="shareCode">Loading...</div>
                    <button class="btn btn-secondary" onclick="copyShareCode()">üìã Copy Code</button>
                </div>
            </div>
            
            <div class="stats-panel">
                <h2>üìä Character Stats</h2>
                
                <div class="stat-item">
                    <div class="stat-label">Rarity Score</div>
                    <div class="stat-value">
                        <span id="rarityScore">0</span>
                        <span class="rarity-indicator rarity-common" id="rarityTier">Common</span>
                    </div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-label">Trait Combination</div>
                    <div class="stat-value" id="traitCount">1/5 Selected</div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-label">Uniqueness</div>
                    <div class="stat-value" id="uniqueness">Calculating...</div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-label">Community Votes</div>
                    <div class="stat-value">‚≠ê <span id="communityVotes">0</span></div>
                </div>
                
                <h3 style="margin-top: 30px; margin-bottom: 15px; color: #ff006e;">üèÜ Achievements</h3>
                <div id="achievements">
                    <div class="stat-item" id="achievement-first">
                        <div class="stat-label">üéØ First Build</div>
                        <div class="stat-value">Locked</div>
                    </div>
                    <div class="stat-item" id="achievement-creative">
                        <div class="stat-label">üé® Creative Combo</div>
                        <div class="stat-value">Locked</div>
                    </div>
                    <div class="stat-item" id="achievement-speed">
                        <div class="stat-label">‚ö° Speed Builder</div>
                        <div class="stat-value">Locked</div>
                    </div>
                    <div class="stat-item" id="achievement-legendary">
                        <div class="stat-label">üëë Legendary Builder</div>
                        <div class="stat-value">Locked</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Character state
        let character = {
            base: 'human',
            outfit: null,
            eyes: null,
            headgear: null,
            special: null
        };
        
        let workshopTime = 300; // 5 minutes
        let buildCount = 0;
        let achievements = new Set();
        
        // Trait rarities
        const rarities = {
            base: { human: 1, robot: 0.3, alien: 0.1 },
            outfit: { ninja: 0.4, suit: 0.3, hoodie: 0.5, armor: 0.2, golden: 0.05 },
            eyes: { normal: 0.6, laser: 0.1, cool: 0.3, heart: 0.2, star: 0.15, diamond: 0.02 },
            headgear: { none: 0.4, cap: 0.3, crown: 0.1, helmet: 0.2, horns: 0.15, halo: 0.05 },
            special: { none: 0.6, fire: 0.15, ice: 0.15, lightning: 0.1, rainbow: 0.02, cosmic: 0.01 }
        };
        
        // Trait emojis
        const traitEmojis = {
            base: { human: 'üßë', robot: 'ü§ñ', alien: 'üëΩ' },
            outfit: { ninja: 'ü•∑', suit: 'ü§µ', hoodie: 'üß•', armor: 'üõ°Ô∏è', golden: 'üëë' },
            eyes: { normal: 'üëÄ', laser: 'üî¥', cool: 'üòé', heart: 'üòç', star: 'ü§©', diamond: 'üíé' },
            headgear: { none: '', cap: 'üß¢', crown: 'üëë', helmet: '‚õëÔ∏è', horns: 'üòà', halo: 'üòá' },
            special: { none: '', fire: 'üî•', ice: '‚ùÑÔ∏è', lightning: '‚ö°', rainbow: 'üåà', cosmic: 'üåå' }
        };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeTraitListeners();
            updatePreview();
            updateStats();
            startWorkshopTimer();
            initializeRotation();
            checkUrlParams();
        });
        
        // Trait selection
        function initializeTraitListeners() {
            const traitOptions = document.querySelectorAll('.trait-option');
            
            traitOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    e.preventDefault();
                    selectTrait(this);
                });
            });
        }
        
        function selectTrait(element) {
            if (element.classList.contains('locked')) {
                showNotification('üîí This trait is locked! Complete achievements to unlock.');
                return;
            }
            
            const trait = element.dataset.trait;
            const value = element.dataset.value;
            
            // Create sparkle effect
            createSparkle(element);
            
            // Clear previous selection in category
            document.querySelectorAll(`[data-trait="${trait}"]`).forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Select new trait
            element.classList.add('selected');
            
            // Update character
            if (value === 'none') {
                character[trait] = null;
            } else {
                character[trait] = value;
            }
            
            updatePreview();
            updateStats();
            checkAchievements();
        }
        
        // Create sparkle effect
        function createSparkle(element) {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            const rect = element.getBoundingClientRect();
            sparkle.style.left = `${rect.left + rect.width / 2 - 10}px`;
            sparkle.style.top = `${rect.top + rect.height / 2 - 10}px`;
            sparkle.style.position = 'fixed';
            document.body.appendChild(sparkle);
            setTimeout(() => sparkle.remove(), 600);
        }
        
        // Update character preview
        function updatePreview() {
            document.getElementById('baseLayer').textContent = traitEmojis.base[character.base] || '';
            document.getElementById('outfitLayer').textContent = traitEmojis.outfit[character.outfit] || '';
            document.getElementById('eyesLayer').textContent = traitEmojis.eyes[character.eyes] || '';
            document.getElementById('headgearLayer').textContent = traitEmojis.headgear[character.headgear] || '';
            document.getElementById('specialLayer').textContent = traitEmojis.special[character.special] || '';
            
            updateShareCode();
        }
        
        // Calculate and update stats
        function updateStats() {
            let rarityScore = 0;
            let traitCount = 0;
            
            Object.entries(character).forEach(([trait, value]) => {
                if (value && value !== 'none') {
                    traitCount++;
                    if (rarities[trait] && rarities[trait][value]) {
                        rarityScore += (1 - rarities[trait][value]) * 100;
                    }
                }
            });
            
            document.getElementById('rarityScore').textContent = Math.round(rarityScore);
            document.getElementById('traitCount').textContent = `${traitCount}/5 Selected`;
            
            // Update rarity tier
            const tierElement = document.getElementById('rarityTier');
            tierElement.classList.remove('rarity-common', 'rarity-uncommon', 'rarity-rare', 'rarity-epic', 'rarity-legendary');
            
            if (rarityScore < 100) {
                tierElement.textContent = 'Common';
                tierElement.classList.add('rarity-common');
            } else if (rarityScore < 200) {
                tierElement.textContent = 'Uncommon';
                tierElement.classList.add('rarity-uncommon');
            } else if (rarityScore < 300) {
                tierElement.textContent = 'Rare';
                tierElement.classList.add('rarity-rare');
            } else if (rarityScore < 400) {
                tierElement.textContent = 'Epic';
                tierElement.classList.add('rarity-epic');
            } else {
                tierElement.textContent = 'Legendary';
                tierElement.classList.add('rarity-legendary');
            }
            
            // Calculate uniqueness
            const uniqueness = Math.min(99, Math.round(rarityScore / 5 + Math.random() * 20 + 60));
            document.getElementById('uniqueness').textContent = `${uniqueness}% Unique`;
            
            // Simulate community votes based on rarity
            const baseVotes = Math.floor(Math.random() * 50);
            const bonusVotes = Math.floor(rarityScore / 10);
            document.getElementById('communityVotes').textContent = baseVotes + bonusVotes;
        }
        
        // Generate share code
        function updateShareCode() {
            const code = btoa(JSON.stringify(character)).replace(/=/g, '').substring(0, 8).toUpperCase();
            document.getElementById('shareCode').textContent = `WORKSHOP-${code}`;
        }
        
        // Copy share code
        function copyShareCode() {
            const code = document.getElementById('shareCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showNotification('üìã Share code copied!');
            });
        }
        
        // Randomize character
        function randomizeCharacter() {
            const traits = ['base', 'outfit', 'eyes', 'headgear', 'special'];
            
            traits.forEach(trait => {
                const options = Object.keys(rarities[trait]).filter(opt => {
                    const element = document.querySelector(`[data-trait="${trait}"][data-value="${opt}"]`);
                    return element && !element.classList.contains('locked');
                });
                
                if (options.length > 0) {
                    // Weighted random selection
                    const weights = options.map(opt => rarities[trait][opt]);
                    const totalWeight = weights.reduce((a, b) => a + b, 0);
                    let random = Math.random() * totalWeight;
                    
                    let selectedOption = options[0];
                    for (let i = 0; i < options.length; i++) {
                        random -= weights[i];
                        if (random <= 0) {
                            selectedOption = options[i];
                            break;
                        }
                    }
                    
                    // Update selection
                    const element = document.querySelector(`[data-trait="${trait}"][data-value="${selectedOption}"]`);
                    selectTrait(element);
                }
            });
            
            showNotification('üé≤ Character randomized!');
        }
        
        // Mint character
        async function mintCharacter() {
            const name = document.getElementById('characterName').value || 'Unnamed Hero';
            
            if (!character.outfit || !character.eyes) {
                showNotification('‚ö†Ô∏è Please select at least an outfit and eyes before minting!');
                return;
            }
            
            // Show loading
            showLoader('Connecting to blockchain...');
            await sleep(1500);
            
            updateLoader('Preparing metadata...', 30);
            await sleep(1000);
            
            updateLoader('Generating NFT...', 60);
            await sleep(1500);
            
            updateLoader('Minting on blockchain...', 90);
            await sleep(2000);
            
            hideLoader();
            
            buildCount++;
            
            // Save to local storage
            saveCharacter(name);
            
            // Show success
            showNotification(`üéâ Successfully minted "${name}"! Build #${buildCount}`);
            
            // Check achievements
            if (buildCount === 1) {
                unlockAchievement('first', 'üéØ First Build');
            }
            
            if (workshopTime > 240) {
                unlockAchievement('speed', '‚ö° Speed Builder');
            }
            
            // Check for legendary build
            const rarityScore = parseInt(document.getElementById('rarityScore').textContent);
            if (rarityScore > 400) {
                unlockAchievement('legendary', 'üëë Legendary Builder');
            }
        }
        
        // Workshop timer
        function startWorkshopTimer() {
            setInterval(() => {
                if (workshopTime > 0) {
                    workshopTime--;
                    const minutes = Math.floor(workshopTime / 60);
                    const seconds = workshopTime % 60;
                    document.getElementById('timerDisplay').textContent = 
                        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                } else {
                    document.getElementById('timerDisplay').textContent = 'Session Complete!';
                }
            }, 1000);
        }
        
        // 3D rotation
        function initializeRotation() {
            const preview = document.getElementById('characterPreview');
            const canvas = document.getElementById('characterCanvas');
            let isRotating = false;
            let startX = 0;
            let currentRotation = 0;
            
            preview.addEventListener('mousedown', (e) => {
                isRotating = true;
                startX = e.clientX;
                preview.style.cursor = 'grabbing';
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isRotating) return;
                
                const deltaX = e.clientX - startX;
                currentRotation += deltaX * 0.5;
                canvas.style.transform = `rotateY(${currentRotation}deg)`;
                startX = e.clientX;
            });
            
            document.addEventListener('mouseup', () => {
                isRotating = false;
                preview.style.cursor = 'grab';
            });
            
            // Touch support
            preview.addEventListener('touchstart', (e) => {
                isRotating = true;
                startX = e.touches[0].clientX;
            });
            
            document.addEventListener('touchmove', (e) => {
                if (!isRotating) return;
                
                const deltaX = e.touches[0].clientX - startX;
                currentRotation += deltaX * 0.5;
                canvas.style.transform = `rotateY(${currentRotation}deg)`;
                startX = e.touches[0].clientX;
            });
            
            document.addEventListener('touchend', () => {
                isRotating = false;
            });
        }
        
        // Achievements
        function checkAchievements() {
            // Creative combo: Robot + Ninja + Laser Eyes
            if (character.base === 'robot' && character.outfit === 'ninja' && character.eyes === 'laser') {
                unlockAchievement('creative', 'üé® Creative Combo');
                
                // Unlock rainbow special
                const rainbowElement = document.querySelector('[data-trait="special"][data-value="rainbow"]');
                if (rainbowElement && rainbowElement.classList.contains('locked')) {
                    rainbowElement.classList.remove('locked');
                    showNotification('üåà Rainbow special unlocked!');
                }
            }
            
            // Alien combo: Alien + Crown + Cosmic
            if (character.base === 'alien' && character.headgear === 'crown' && character.special === 'cosmic') {
                unlockAchievement('legendary', 'üëë Legendary Builder');
            }
        }
        
        function unlockAchievement(id, name) {
            if (achievements.has(id)) return;
            
            achievements.add(id);
            const achievementElement = document.getElementById(`achievement-${id}`);
            
            if (achievementElement) {
                achievementElement.classList.add('unlocked');
                achievementElement.querySelector('.stat-value').textContent = 'Unlocked! ‚ú®';
                showNotification(`üèÜ Achievement Unlocked: ${name}`);
                
                // Unlock special items based on achievement
                if (id === 'creative') {
                    document.querySelector('[data-trait="special"][data-value="rainbow"]').classList.remove('locked');
                    document.querySelector('[data-trait="eyes"][data-value="diamond"]').classList.remove('locked');
                }
                
                if (id === 'legendary') {
                    document.querySelector('[data-trait="special"][data-value="cosmic"]').classList.remove('locked');
                    document.querySelector('[data-trait="outfit"][data-value="golden"]').classList.remove('locked');
                }
            }
        }
        
        // Helper functions
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        function showLoader(text) {
            const loader = document.getElementById('loader');
            const loaderText = document.getElementById('loaderText');
            const progress = document.getElementById('loaderProgress');
            
            loaderText.textContent = text;
            progress.style.width = '10%';
            loader.classList.add('active');
        }
        
        function updateLoader(text, percent) {
            document.getElementById('loaderText').textContent = text;
            document.getElementById('loaderProgress').style.width = `${percent}%`;
        }
        
        function hideLoader() {
            document.getElementById('loader').classList.remove('active');
        }
        
        function showNotification(text) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = text;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Save character to local storage
        function saveCharacter(name) {
            const builds = JSON.parse(localStorage.getItem('nftWorkshopBuilds') || '[]');
            builds.push({
                name: name,
                character: character,
                timestamp: Date.now(),
                rarityScore: parseInt(document.getElementById('rarityScore').textContent)
            });
            localStorage.setItem('nftWorkshopBuilds', JSON.stringify(builds));
        }
        
        // Load from URL params
        function checkUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const buildCode = params.get('build');
            
            if (buildCode) {
                try {
                    const decoded = JSON.parse(atob(buildCode));
                    character = decoded;
                    
                    // Update UI
                    Object.entries(character).forEach(([trait, value]) => {
                        if (value) {
                            const element = document.querySelector(`[data-trait="${trait}"][data-value="${value}"]`);
                            if (element) {
                                selectTrait(element);
                            }
                        }
                    });
                    
                    showNotification('üîó Build loaded from share code!');
                } catch (e) {
                    console.error('Invalid build code:', e);
                }
            }
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'r' && (e.ctrlKey || e.metaKey)) {
                e.preventDefault();
                randomizeCharacter();
            }
            
            if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                e.preventDefault();
                mintCharacter();
            }
        });
        
        // Auto-save draft
        setInterval(() => {
            const draft = {
                character: character,
                name: document.getElementById('characterName').value
            };
            localStorage.setItem('nftWorkshopDraft', JSON.stringify(draft));
        }, 5000);
        
        // Load draft on startup
        window.addEventListener('load', () => {
            const draft = localStorage.getItem('nftWorkshopDraft');
            if (draft) {
                try {
                    const parsed = JSON.parse(draft);
                    if (parsed.name) {
                        document.getElementById('characterName').value = parsed.name;
                    }
                } catch (e) {
                    console.error('Error loading draft:', e);
                }
            }
        });
    </script>
</body>
</html>